<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Employee Joining Form</title>
<style>
  /* ---------- Loader Styles ---------- */
  #loaderOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
  }
  .loader {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #3498db;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin-bottom: 12px;
  }
  @keyframes spin { 
    0% { transform: rotate(0deg); } 
    100% { transform: rotate(360deg); }
  }

  /* ---------- Root Colors & Body ---------- */
  :root { 
    --bg:#f6f8fb; --card:#ffffff; --text:#111827; --muted:#6b7280; 
    --accent:#2563eb; --accent-2:#1d4ed8; --border:#e5e7eb; 
  }
  * { box-sizing: border-box; }
  body { margin:0; background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }

  /* ---------- Wrapper ---------- */
  .wrap { max-width: 1080px; margin: 32px auto; padding: 0 20px; }

  /* ---------- Headings ---------- */
  h1 { margin:0 0 18px; font-size: 30px; text-align:center; font-weight:800; letter-spacing:.2px; }
  .sub { text-align:center; color:var(--muted); margin-bottom:22px; }

  /* ---------- Logo ---------- */
  .logo {
    display: block;
    margin: 0 auto 20px auto; /* center horizontally + spacing below */
    max-width: 300px;
    height: auto;
  }

  /* ---------- Form ---------- */
  form { background:var(--card); border:1px solid var(--border); border-radius:16px; padding: 24px; box-shadow: 0 12px 30px rgba(0,0,0,.06); }
  .section {
    border:1px solid var(--border);
    border-radius:14px;
    padding:18px;
    margin-bottom:18px;
    background:#fff;
  }
  .section h3 {
    margin:0 0 14px;
    font-size:18px; font-weight:800;
    display:flex; align-items:center; gap:10px;
  }
  .badge {
    background:#eef2ff; color:#4338ca; border:1px solid #c7d2fe;
    padding:4px 10px; border-radius:999px; font-size:12px; font-weight:700;
  }

  .grid { display:grid; grid-template-columns: repeat(12, minmax(0,1fr)); gap: 14px; }
  .col-12 { grid-column: span 12; }
  .col-6  { grid-column: span 6; }
  .col-4  { grid-column: span 4; }
  .col-3  { grid-column: span 3; }
  .col-8  { grid-column: span 8; }

  label { display:block; font-size: 13px; color: var(--muted); margin-bottom:6px; }
  input, select, textarea {
    width:100%; padding:11px 12px; border:1px solid var(--border);
    border-radius:10px; font-size:14px; background:#fff; outline:none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--accent); box-shadow: 0 0 0 3px rgba(37,99,235,.12);
  }
  input[readonly] { background:#f3f4f6; }
  .hint { font-size:12px; color:#6b7280; margin-top:6px; }
  .error { color:#b91c1c; font-size: 13px; margin-top: 6px; }
  .row { display:flex; gap:10px; }
  .row > * { flex:1; }
  .req { color:#ef4444; font-weight:700; margin-left:4px; }
  .hidden { display:none !important; }

  .toolbar {
    display:flex; justify-content: space-between; align-items:center;
    padding:12px 0 0; gap:12px;
  }
  .btn {
    display:inline-flex; gap:8px; align-items:center; justify-content:center;
    padding:12px 18px; border:none; border-radius:10px;
    background:var(--accent); color:#fff; font-weight:700; cursor:pointer;
  }
  .btn:hover { background: var(--accent-2); }
  .note { color:var(--muted); font-size:12px; }

  @media (max-width: 980px) {
    .col-6, .col-4, .col-3, .col-8 { grid-column: span 12; }
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- Company Logo -->
  <img src="https://raw.githubusercontent.com/SeedsFincappvtltd/Joining-Form/main/Company%20Logo.png" 
       alt="Company Logo" class="logo">

  <h1>Employee Joining Form</h1>
<div class="sub">Please fill all required fields marked with <span class="req">*</span></div>

<form id="employeeForm" action="https://script.google.com/macros/s/AKfycbzc2BmiZxuknJ7H-brNxk9w9ouLPS3hhJESZa-6NxQyFwdAxjeRAQ_sqX62aTf1jXld/exec" method="POST" enctype="multipart/form-data">

      <!-- ================= Personal Details ================= -->
      <div class="section">
        <h3>Personal Details <span class="badge">Section 1</span></h3>
        <div class="grid">
          <div class="col-12">
            <label for="fullName">Full Name <span class="req">*</span></label>
            <input id="fullName" name="fullName" type="text" required pattern="[A-Za-z ]+" placeholder="e.g., Full Name">
            <div class="hint">Alphabets and spaces only.</div>
          </div>

          <div class="col-12">
            <label for="fatherName">Father's Name <span class="req">*</span></label>
            <input id="fatherName" name="fatherName" type="text" required pattern="[A-Za-z ]+" placeholder="e.g., Father's Name">
          </div>

          <div class="col-4">
            <label for="gender">Gender <span class="req">*</span></label>
            <select id="gender" name="gender" required>
              <option value="">Select…</option>
              <option>Male</option><option>Female</option><option>Other</option>
            </select>
          </div>

          <div class="col-4">
            <label for="dob">Date of Birth <span class="req">*</span></label>
            <input id="dob" name="dob" type="date" required>
            <span id="ageDisplay" class="highlight"></span>
          </div>

          <div class="col-4">
            <label for="bloodGroup">Blood Group <span class="req">*</span></label>
            <select id="bloodGroup" name="bloodGroup" required>
              <option value="">Select…</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>O+</option><option>O-</option>
              <option>AB+</option><option>AB-</option>
              <option>NA</option>
            </select>
          </div>

          <div class="col-6">
            <label for="mobile">Mobile Number <span class="req">*</span></label>
            <input id="mobile" name="mobile" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" required placeholder="10 digits">
          </div>

          <div class="col-6">
            <label for="email">Email Address <span class="req">*</span></label>
            <input id="email" name="email" type="email" required placeholder="name@example.com">
          </div>

          <div class="col-4">
            <label for="maritalStatus">Marital Status <span class="req">*</span></label>
            <select id="maritalStatus" name="maritalStatus" required>
              <option value="">Select…</option>
              <option value="Married">Married</option>
              <option value="Unmarried">Unmarried</option>
              <option value="Divorced">Divorced</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ================= Spouse & Children (Married only) ================= -->
      <div id="spouseSection" class="section hidden">
        <h3>Spouse & Children Details <span class="badge">Section 2</span></h3>
        <div class="grid">
          <div class="col-4">
            <label for="spouseName">Spouse Name <span class="req">*</span></label>
            <input id="spouseName" name="spouseName" type="text" pattern="[A-Za-z ]+">
          </div>

          <div class="col-4">
            <label for="spouseDob">Spouse DOB <span class="req">*</span></label>
            <input id="spouseDob" name="spouseDob" type="date">
          </div>

          <div class="col-4">
            <label for="marriageDate">Date of Marriage <span class="req">*</span></label>
            <input id="marriageDate" name="marriageDate" type="date">
          </div>

          <div class="col-4">
            <label for="hasChildren">Do you have children? <span class="req">*</span></label>
            <select id="hasChildren" name="hasChildren">
              <option value="">Select…</option>
              <option value="No">No</option>
              <option value="Yes">Yes</option>
            </select>
          </div>

          <div id="childrenBlock" class="col-12 hidden">
            <div class="grid">
              <div class="col-3">
                <label for="childrenCount">How many children? <span class="req">*</span></label>
                <select id="childrenCount" name="childrenCount">
                  <option value="">Select…</option>
                  <option value="1">One</option>
                  <option value="2">Two</option>
                </select>
              </div>
            </div>

            <div id="child1" class="section hidden" style="margin-top:12px;">
              <div class="grid">
                <div class="col-6">
                  <label for="child1Name">Child 1 Name <span class="req">*</span></label>
                  <input id="child1Name" name="child1Name" type="text" pattern="[A-Za-z ]+">
                </div>
                <div class="col-6">
                  <label for="child1Dob">Child 1 DOB <span class="req">*</span></label>
                  <input id="child1Dob" name="child1Dob" type="date">
                </div>
              </div>
            </div>

            <div id="child2" class="section hidden" style="margin-top:12px;">
              <div class="grid">
                <div class="col-6">
                  <label for="child2Name">Child 2 Name <span class="req">*</span></label>
                  <input id="child2Name" name="child2Name" type="text" pattern="[A-Za-z ]+">
                </div>
                <div class="col-6">
                  <label for="child2Dob">Child 2 DOB <span class="req">*</span></label>
                  <input id="child2Dob" name="child2Dob" type="date">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ================= Parents (Always required) ================= -->
      <div id="parentsSection" class="section">
       <h3>Parents' Details <span class="badge">Section 3</span></h3>
       <div class="grid">
        <div class="col-4">
         <label for="fatherDob">Father's DOB <span class="req">*</span></label>
         <input id="fatherDob" name="fatherDob" type="date" required>
        </div>
        <div class="col-4">
         <label for="motherName">Mother's Name <span class="req">*</span></label>
         <input id="motherName" name="motherName" type="text" pattern="[A-Za-z ]+" required>
        </div>
        <div class="col-4">
         <label for="motherDob">Mother's DOB <span class="req">*</span></label>
         <input id="motherDob" name="motherDob" type="date" required>
        </div>

        <div class="col-4">
         <label for="hasbrother">Do you have Brother <span class="req">*</span></label>
         <select id="hasbrother" name="hasbrother" onchange="updatehasbrother()">
          <option value="">Select…</option>
          <option value="No">No</option>
          <option value="Yes">Yes</option>
         </select>
        </div>

        <div id="brotherBlock" class="col-12 hidden" style="margin-top:16px;">
         <div class="grid">
          <div class="col-6">
           <label for="BrotherCount">How many Brother? <span class="req">*</span></label>
           <select id="BrotherCount" name="BrotherCount" onchange="toggleBrotherCount()">
            <option value="">Select…</option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
           </select>
         </div>
       </div>

      <!-- Brother 1 -->
       <div id="Brother1" class="grid hidden" style="margin-top:12px;">
        <div class="col-4">
          <label for="BrotherName1">Brother Name 1 <span class="req">*</span></label>
          <input id="BrotherName1" name="BrotherName1" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="BrotherNumber1">Brother Number 1 <span class="req">*</span></label>
          <input id="BrotherNumber1" name="BrotherNumber1" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
        <div class="col-4">
          <label for="BrotherOccupation1">Brother Occupation 1 <span class="req">*</span></label>
          <input id="BrotherOccupation1" name="BrotherOccupation1" type="text" pattern="[A-Za-z ]+">
        </div>
      </div>

      <!-- Brother 2 -->
      <div id="Brother2" class="grid hidden" style="margin-top:12px;">
        <div class="col-4">
          <label for="BrotherName2">Brother Name 2 <span class="req">*</span></label>
          <input id="BrotherName2" name="BrotherName2" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="BrotherNumber2">Brother Number 2 <span class="req">*</span></label>
          <input id="BrotherNumber2" name="BrotherNumber2" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
        <div class="col-4">
          <label for="BrotherOccupation2">Brother Occupation 2 <span class="req">*</span></label>
          <input id="BrotherOccupation2" name="BrotherOccupation2" type="text" pattern="[A-Za-z ]+">
        </div>
      </div>

      <!-- Brother 3 -->
      <div id="Brother3" class="grid hidden" style="margin-top:12px;">
        <div class="col-4">
          <label for="BrotherName3">Brother Name 3 <span class="req">*</span></label>
          <input id="BrotherName3" name="BrotherName3" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="BrotherNumber3">Brother Number 3 <span class="req">*</span></label>
          <input id="BrotherNumber3" name="BrotherNumber3" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
        <div class="col-4">
          <label for="BrotherOccupation3">Brother Occupation 3 <span class="req">*</span></label>
          <input id="BrotherOccupation3" name="BrotherOccupation3" type="text" pattern="[A-Za-z ]+">
        </div>
      </div>
    </div>
  </div>
</div>

      <!-- ================= Identification ================= -->
      <div class="section">
        <h3>Identification <span class="badge">Section 4</span></h3>
        <div class="grid">
          <div class="col-4">
            <label for="aadhaar">Aadhaar Number <span class="req">*</span></label>
            <input id="aadhaar" name="aadhaar" type="text" inputmode="numeric" maxlength="12" pattern="[0-9]{12}" required>
          </div>

          <div class="col-4">
            <label for="pan">PAN Number <span class="req">*</span></label>
            <input id="pan" name="pan" type="text" maxlength="10" required pattern="[A-Z]{3}P[A-Z]{1}[0-9]{4}[A-Z]" placeholder="e.g., ABCPD1234F">
            <div class="hint">Format: 3 letters, <strong>P</strong>,1 letter, 4 digits, 1 letter</div>
          </div>

          <div class="col-4">
            <label for="dl">Driving License Number <span class="req">*</span></label>
            <input id="dl" name="dl" type="text" pattern="[A-Za-z0-9]+" required>
          </div>
        </div>
      </div>

      <!-- ================= Address ================= -->
      <div class="section">
        <h3>Address Details <span class="badge">Section 5</span></h3>
        <div class="grid">
          <div class="col-12"><strong>Permanent Address</strong></div>
          <div class="col-12">
            <label for="permAddress">Address <span class="req">*</span></label>
            <input id="permAddress" name="permAddress" required>
          </div>
          <div class="col-4">
            <label for="permCity">City <span class="req">*</span></label>
            <input id="permCity" name="permCity" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="permState">State <span class="req">*</span></label>
            <input id="permState" name="permState" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="permPincode">Pincode <span class="req">*</span></label>
            <input id="permPincode" name="permPincode" inputmode="numeric" maxlength="6" pattern="[0-9]{6}" required>
          </div>

          <div class="col-12" style="margin-top:4px;"><strong>Current Address</strong></div>
          <div class="col-12">
            <label><input type="checkbox" id="sameAddress"> Current address same as Permanent</label>
          </div>
          <div class="col-12">
            <label for="currAddress">Address <span class="req">*</span></label>
            <input id="currAddress" name="currAddress" required>
          </div>
          <div class="col-4">
            <label for="currCity">City <span class="req">*</span></label>
            <input id="currCity" name="currCity" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="currState">State <span class="req">*</span></label>
            <input id="currState" name="currState" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="currPincode">Pincode <span class="req">*</span></label>
            <input id="currPincode" name="currPincode" inputmode="numeric" maxlength="6" pattern="[0-9]{6}" required>
          </div>
        </div>
      </div>

      <!-- ================= Job Details ================= -->
      <div class="section">
        <h3>Job Details <span class="badge">Section 6</span></h3>
        <div class="grid">
          <div class="col-4">
            <label for="doj">Date of Joining <span class="req">*</span></label>
            <input id="doj" name="doj" type="date" required>
            <div class="hint">Must be today or within the last 2 days.</div>
          </div>

          <div class="col-4">
            <label for="department">Department <span class="req">*</span></label>
            <select id="department" name="department" required>
              <option value="">Select…</option>
              <option>Business-IL</option>
              <option>Secured Business Loan</option>
              <option>Credit</option>
              <option>Collection</option>
              <option>HR</option>
              <option>IT</option>
              <option>Operations</option>
              <option>RISK</option>
              <option>Audit</option>
              <option>TVR</option>
              <option>Sales Calling</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div id="otherDeptWrap" class="col-4 hidden">
            <label for="otherDepartment">Other Department <span class="req">*</span></label>
            <input id="otherDepartment" name="otherDepartment" pattern="[A-Za-z ]+">
          </div>

          <div id="designationWrap" class="col-4">
            <label for="designation">Designation <span class="req">*</span></label>
            <input id="designation" name="designation" pattern="[A-Za-z ]+" required>
          </div>

          <div class="col-4">
            <label for="region">Region <span class="req">*</span></label>
            <select id="region" name="region" required>
              <option value="">Select…</option>
              <option>Head Office</option>
              <option>Agra</option>
              <option>Karnal</option>
              <option>Rewari</option>
              <option>Jaipur</option>
              <option>Hapur</option>
              <option>Gorakhpur</option>
              <option>Indore</option>
            </select>
          </div>

          <div class="col-4">
            <label for="branch">Branch <span class="req">*</span></label>
            <input id="branch" name="branch" required pattern="[A-Za-z ]+">
          </div>

          <div class="col-4">
            <label for="EPSScheme">Member of EPS Scheme? <span class="req">*</span></label>
            <select id="EPSScheme" name="EPSScheme" required>
              <option value="">Select…</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>

          <div class="col-4">
            <label for="uan">UAN Number <span class="req">*</span></label>
            <input id="uan" name="uan" inputmode="numeric" maxlength="12" pattern="[0-9]{12}" required>
          </div>

          <div class="col-4">
            <label for="esic">ESIC Number <span class="req">*</span></label>
            <input id="esic" name="esic" required>
          </div>
        </div>
      </div>

      <!-- ================= Education & Bank ================= -->
      <div class="section">
        <h3>Education & Bank Details <span class="badge">Section 7</span></h3>
        <div class="grid">
          <div class="col-4">
            <label for="qualification">Highest Qualification <span class="req">*</span></label>
            <select id="qualification" name="qualification" required>
              <option value="">Select…</option>
              <option>PGDM</option>
              <option>Post Graduate</option>
              <option>Graduate</option>
              <option>Intermediate</option>
            </select>
          </div>

          <div class="col-4">
            <label for="bank">Select Your Bank <span class="req">*</span></label>
            <select id="bank" name="bank" required>
              <option value="">Select…</option>
              <option>State Bank of India</option>
              <option>HDFC Bank</option>
              <option>AU Small Finance Bank</option>
              <option>Indian Bank</option>
              <option>ICICI Bank</option>
              <option>Axis Bank</option>
              <option>RBL Bank</option>
              <option>Bank of Baroda</option>
              <option>Punjab National Bank</option>
              <option>Canara Bank</option>
              <option>Bank of India</option>
              <option>Union Bank of India</option>
              <option>Central Bank of India</option>
              <option>Indian Overseas Bank</option>
              <option>UCO Bank</option>
              <option>Punjab & Sind Bank</option>
              <option>IDBI Bank</option>
              <option>IDBI First Bank</option>
              <option>Kotak Mahindra Bank</option>
              <option>IndusInd Bank</option>
              <option>Yes Bank</option>
              <option>Bandhan Bank</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div id="otherBankWrap" class="col-4 hidden">
            <label for="otherBank">Other Bank Name <span class="req">*</span></label>
            <input id="otherBank" name="otherBank">
          </div>

          <div class="col-4">
            <label for="accountNumber">Bank Account Number <span class="req">*</span></label>
            <input id="accountNumber" name="accountNumber" inputmode="numeric" pattern="[0-9]+" required>
          </div>

          <div class="col-4">
            <label for="confirmAccountNumber">Confirm Bank Account Number <span class="req">*</span></label>
            <input id="confirmAccountNumber" name="confirmAccountNumber" inputmode="numeric" pattern="[0-9]+" required>
            <div id="acctErr" class="error hidden">Account numbers do not match.</div>
          </div>

          <div class="col-4">
            <label for="ifsc">IFSC Code <span class="req">*</span></label>
            <input id="ifsc" name="ifsc" maxlength="11" pattern="[A-Z]{4}0[A-Z0-9]{6}" required placeholder="e.g., SBIN0XXXXXX">
          </div>
        </div>
      </div>

      <!-- ================= Experience / Fresher ================= -->
      <div class="section">
    <h3>Work History <span class="badge">Section 8</span></h3>
    <div class="grid">
      <div class="col-4">
        <label for="expStatus">Experienced / Fresher <span class="req">*</span></label>
        <select id="expStatus" name="expStatus" required>
          <option value="">Select…</option>
          <option value="Experienced">Experienced</option>
          <option value="Fresher">Fresher</option>
        </select>
      </div>
    </div>

    <!-- Experienced -->
    <div id="expDetails" class="section hidden" style="margin-top:12px;">
      <div class="grid">
        <div class="col-12"><strong>Previous Employment</strong></div>
        <div class="col-4">
          <label for="prevCompany">Previous Company Name <span class="req">*</span></label>
          <input id="prevCompany" name="prevCompany" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="prevDesignation">Previous Designation <span class="req">*</span></label>
          <input id="prevDesignation" name="prevDesignation" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="prevBranch">Previous Branch <span class="req">*</span></label>
          <input id="prevBranch" name="prevBranch" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="lastWorkingDay">Last Working Day <span class="req">*</span></label>
          <input id="lastWorkingDay" name="lastWorkingDay" type="date">
        </div>
        <div class="col-4">
          <label for="rmname1">Reporting Manager Name 1 <span class="req">*</span></label>
          <input id="rmname1" name="rmname1" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="rmnumber1">Reporting Manager Number 1 <span class="req">*</span></label>
          <input id="rmnumber1" name="rmnumber1" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
        <div class="col-4">
          <label for="rmname2">Reporting Manager Name 2 <span class="req">*</span></label>
          <input id="rmname2" name="rmname2" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="rmnumber2">Reporting Manager Number 2 <span class="req">*</span></label>
          <input id="rmnumber2" name="rmnumber2" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
      </div>
    </div>

    <!-- Fresher -->
    <div id="fresherDetails" class="section hidden" style="margin-top:12px;">
      <div class="grid">
        <div class="col-12"><strong>Reference Details</strong></div>
        <div class="col-4">
          <label for="friendname1">Friend's Name 1 <span class="req">*</span></label>
          <input id="friendname1" name="friendname1" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="friendnumber1">Friend's Number 1 <span class="req">*</span></label>
          <input id="friendnumber1" name="friendnumber1" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>
        <div class="col-4">
          <label for="  ">Friend's Name 2 <span class="req">*</span></label>
          <input id="friendname2" name="friendname2" type="text" pattern="[A-Za-z ]+">
        </div>
        <div class="col-4">
          <label for="friendnumber2">Friend's Number 2 <span class="req">*</span></label>
          <input id="friendnumber2" name="friendnumber2" type="text" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" placeholder="10 digits">
        </div>  
      </div>
    </div>

    <!-- Referral (Always Visible & Mandatory) -->
    <div id="referral" class="section" style="margin-top:12px;">
      <div class="grid">
        <div class="col-12"><strong>Referral</strong></div>
        <div class="col-4">
          <label for="refBy">Referred by <span class="req">*</span></label>
          <select id="refBy" name="refBy" required>
            <option value="">Select…</option>
            <option>Social Media</option>
            <option>Job Portal</option>
            <option>Seeds Employee reference</option>
          </select>
        </div>
            <div id="refExtra" class="col-12 hidden">
              <div class="grid">
                <div class="col-4">
                  <label for="refCode">Employee code of referrer <span class="req">*</span></label>
                  <input id="refCode" name="refCode" pattern="[0-9]+">
                </div>
                <div class="col-4">
                  <label for="refName">Employee name of referrer <span class="req">*</span></label>
                  <input id="refName" name="refName" pattern="[A-Za-z ]+" readonly>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ================= Nominee & Emergency ================= -->
      <div class="section">
        <h3>Nominee & Emergency Contacts <span class="badge">Section 9</span></h3>
        <div class="grid">
          <div class="col-4">
            <label for="nomineeName">Nominee's Name <span class="req">*</span></label>
            <input id="nomineeName" name="nomineeName" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="nomineeDob">Nominee's Date of Birth <span class="req">*</span></label>
            <input id="nomineeDob" name="nomineeDob" type="date" required>
          </div>
          <div class="col-4">
            <label for="nomineeRelation">Nominee's Relation <span class="req">*</span></label>
            <select id="nomineeRelation" name="nomineeRelation" required>
              <option>Father</option><option>Mother</option><option>Spouse</option><option>Brother</option><option>Sister</option>
            </select>
          </div>
          <div class="col-4">
            <label for="nomineeShare">Nominee's Share <span class="req">*</span></label>
            <input id="nomineeShare" name="nomineeShare" value="100%" readonly>
          </div>

          <div class="col-12" style="margin-top:6px;"><strong>Emergency Contacts</strong></div>

          <div class="col-4">
            <label for="emgName1">Emergency Contact Name 1 <span class="req">*</span></label>
            <input id="emgName1" name="emgName1" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="emgNum1">Emergency Contact Number 1 <span class="req">*</span></label>
            <input id="emgNum1" name="emgNum1" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" required>
            <div id="emg1Err" class="error hidden">Emergency number 1 must be different from mobile.</div>
          </div>
          <div class="col-4">
            <label for="emgRel1">Relation 1 <span class="req">*</span></label>
            <select id="emgRel1" name="emgRel1" required>
              <option>Father</option><option>Mother</option><option>Spouse</option><option>Brother</option><option>Sister</option>
            </select>
          </div>

          <div class="col-4">
            <label for="emgName2">Emergency Contact Name 2 <span class="req">*</span></label>
            <input id="emgName2" name="emgName2" required pattern="[A-Za-z ]+">
          </div>
          <div class="col-4">
            <label for="emgNum2">Emergency Contact Number 2 <span class="req">*</span></label>
            <input id="emgNum2" name="emgNum2" inputmode="numeric" minlength="10" maxlength="10" pattern="[0-9]{10}" required>
            <div id="emg2Err" class="error hidden">Emergency number 2 must be different from mobile.</div>
          </div>
          <div class="col-4">
            <label for="emgRel2">Relation 2 <span class="req">*</span></label>
            <select id="emgRel2" name="emgRel2" required>
              <option>Father</option><option>Mother</option><option>Spouse</option><option>Brother</option><option>Sister</option>
            </select>
          </div>
        </div>
      </div>
<!-- ================= Documents Upload ================= -->
<div class="section">
  <h3>Documents Upload <span class="badge">Section 10</span></h3>
  <div class="grid">
  <div class="col-6">
   <label for="signatureUpload">Signature Upload <span class="req">*</span></label>
   <input id="signatureUpload" name="signatureUpload" type="file" accept=".jpg,.jpeg,.png,.pdf" required>
  </div>

    <div class="col-6">
      <label for="resume">Resume <span class="req">*</span></label>
      <input id="resume" name="resume" type="file" accept=".pdf,.doc,.docx" required>
    </div>

    <div class="col-6">
      <label for="Cibil">Cibil Report <span class="req">*</span></label>
      <input id="Cibil" name="Cibil" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="photo">Photo <span class="req">*</span></label>
      <input id="photo" name="photo" type="file" accept=".jpg,.jpeg,.png" required>
    </div>

    <div class="col-6">
      <label for="aadhaarUpload">Aadhaar (Multiple Upload) <span class="req">*</span></label>
      <input id="aadhaarUpload" name="aadhaarUpload[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="panUpload">PAN <span class="req">*</span></label>
      <input id="panUpload" name="panUpload" type="file" accept=".pdf,.jpg,.jpeg,.png" required>
    </div>

    <div class="col-6">
      <label for="dlUpload">Driving License (Multiple Upload) <span class="req">*</span></label>
      <input id="dlUpload" name="dlUpload[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="familyPhoto">Family Photo (For ESIC) (Multiple Upload) <span class="req">*</span></label>
      <input id="familyPhoto" name="familyPhoto[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="fatherAadhaar">Father's Aadhaar (Multiple Upload) <span class="req">*</span></label>
      <input id="fatherAadhaar" name="fatherAadhaar[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="motherAadhaar">Mother's Aadhaar (Multiple Upload) <span class="req">*</span></label>
      <input id="motherAadhaar" name="motherAadhaar[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div id="spouseAadhaarUpload" class="col-6 hidden">
      <label for="spouseAadhaar">Spouse Aadhaar (Multiple Upload) <span class="req">*</span></label>
      <input id="spouseAadhaar" name="spouseAadhaar[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple>
    </div>

    <div id="childrenAadhaarUpload" class="col-6 hidden">
      <label for="childrenAadhaar">Children Aadhaar (Multiple Upload) <span class="req">*</span></label>
      <input id="childrenAadhaar" name="childrenAadhaar[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple>
    </div>

    <div class="col-6">
      <label for="educationCert">Educational Certificates (Multiple Upload) <span class="req">*</span></label>
      <input id="educationCert" name="educationCert[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div id="relievingWrap" class="col-6 hidden">
      <label for="relievingLetter">Relieving Letter (Multiple Upload) <span class="req">*</span></label>
      <input id="relievingLetter" name="relievingLetter[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple>
    </div>

    <div id="salarySlipWrap" class="col-6 hidden">
      <label for="salarySlips">Three Months Salary Slips (Multiple Upload) <span class="req">*</span></label>
      <input id="salarySlips" name="salarySlips[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple>
    </div>

    <div class="col-6">
      <label for="formF">Form-F Nomination (Multiple Upload) <span class="req">*</span></label>
      <input id="formF" name="formF[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="esicForm">ESIC Form No.1 (Multiple Upload) <span class="req">*</span></label>
      <input id="esicForm" name="esicForm[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-6">
      <label for="epfForm">EPF Form No.11 (Multiple Upload) <span class="req">*</span></label>
      <input id="epfForm" name="epfForm[]" type="file" accept=".pdf,.jpg,.jpeg,.png" multiple required>
    </div>

    <div class="col-12" style="margin-top:20px; text-align:center;">
      <div class="terms-card" style="
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 15px 20px;
        border: 1px solid #e5e7eb;
        background: #f9fafb;
        border-radius: 10px;
      ">
      <input type="checkbox" id="agree" name="agree" required disabled
         style="transform: scale(1.3); cursor:not-allowed;" />
      <label for="agree" style="margin:0; font-size:15px; cursor:pointer;">
          I agree with 
          <a href="#" onclick="openTerms(event)" 
            style="color:#2563eb; font-weight:500; text-decoration:underline;">
            Terms & Conditions
          </a>
          <span class="req">*</span>
        </label>
      </div>
      <div id="agreeError" class="error" 
       style="color:red; font-size:13px; margin-top:6px; text-align:center;">
      </div>
    </div>

<!-- Modal with PDF -->
    <div id="termsModal" class="hidden">
     <div class="modal-content">
      <span class="close-btn" onclick="closeTerms()">&times;</span>
      <h2>Terms & Conditions</h2>

    <!-- Scrollable container -->
      <div id="pdfContainer">
       <iframe 
        src="https://docs.google.com/gview?url=https://raw.githubusercontent.com/SeedsFincappvtltd/Joining-Form/763d00fa754e81210694c06287d3ef446e7485e4/Terms-and-conditions.pdf&embedded=true" 
        width="100%" 
        height="100%"
        style="border:none;">
       </iframe>
      </div>

      <br/>
      <button id="closeBtn" onclick="closeTerms()" disabled>Close</button>
      <p id="scrollNote" style="color:red; font-size:13px;">
        Please scroll to the bottom to enable the Close button.
      </p>
     </div>
    </div>

    <style>
    /* Modal background */
    #termsModal {
     position: fixed;
     top: 0; left: 0; right: 0; bottom: 0;
     background: rgba(0,0,0,0.7);
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 2000;
    }
    #termsModal.hidden { display: none; }

    /* Modal content */
    .modal-content {
     background: #fff;
     padding: 20px;
     border-radius: 12px;
     width: 95%;
     height: 95%;
     overflow: auto;
     box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .modal-content h2 { 
      margin-top: 0;
      margin-bottom: 10px; 
    }

    .modal-content button {
     margin-top: 10px;
     padding: 10px 20px;
     background: #2563eb;
     color: #fff;
     border: none;
     border-radius: 8px;
     cursor: not-allowed;
     opacity: 0.6;
     align-self: flex-end;
    }
    .modal-content button.enabled {
     cursor: pointer;
     opacity: 1;
    }

    /* Scrollable PDF container */
    #pdfContainer {
     width: 100%;
     height: 100%;
     overflow-y: scroll;
     border: 1px solid #ccc;
     border-radius: 8px;
    }
    #pdfContainer iframe {
     width: 100%;
     height: 800px; /* taller than container so scroll is required */
     border: none;
    }
    </style>

    <script>
     let hasScrolledToBottom = false;
     
     function openTerms(event) {
      event.preventDefault();
      document.getElementById("termsModal").classList.remove("hidden");
    }

    // Close modal & enable checkbox
    function closeTerms() {
     document.getElementById("termsModal").classList.add("hidden");
     if (hasScrolledToBottom) {
      const agree = document.getElementById("agree");
      agree.disabled = false;
      agree.style.cursor = "pointer";
     }
    } 
    // Detect scroll inside container
    document.addEventListener("DOMContentLoaded", () => {
     const container = document.getElementById("pdfContainer");
     const closeBtn = document.getElementById("closeBtn");
     const scrollNote = document.getElementById("scrollNote");

     container.addEventListener("scroll", () => {
      if (container.scrollTop + container.clientHeight >= container.scrollHeight - 10) {
       hasScrolledToBottom = true; 
       closeBtn.disabled = false;
       closeBtn.classList.add("enabled");
       closeBtn.style.cursor = "pointer";
       scrollNote.style.display = "none";
      }
     });
    });

    function validateForm() {
      const agree = document.getElementById("agree");
      const error = document.getElementById("agreeError");

      if (!agree.checked) {
        error.textContent = "⚠️ Please accept Terms & Conditions before submitting.";
        return false; // prevent form submission
      }

      error.textContent = "";
      return true; // allow submission
    }
    </script>


<div class="toolbar">
  <span class="note">Review before submitting. Required fields are validated.</span>
  <button type="submit" id= "submitBtn" class="btn">Submit</button>
</div>

<script>
  // ---------- Helpers ----------
  const $ = (id) => document.getElementById(id);
  const show = (el) => el.classList.remove('hidden');
  const hide = (el) => el.classList.add('hidden');
  const setReq = (el, req) => { if (!el) return; el.required = !!req; };

  // ---------- Loader functions ----------
  const loaderOverlay = document.getElementById("loaderOverlay");
  
  function showLoader() {
    $('loaderOverlay').style.display = 'flex';
  }
  function hideLoader() {
    $('loaderOverlay').style.display = 'none';
  }

  // ---------- Age calculation ----------
  function calculateAge() {
    const dob = $('dob').value;
    if (!dob) {
      $('ageDisplay').textContent = '';
      return;
    }
    const birthDate = new Date(dob);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
    $('ageDisplay').textContent = age >= 0 ? `Age: ${age} years` : '';
  }
  $('dob').addEventListener('change', calculateAge);

  // ---------- Uppercase PAN + IFSC ----------
  $('pan').addEventListener('input', () => { $('pan').value = $('pan').value.toUpperCase(); });
  $('ifsc').addEventListener('input', () => { $('ifsc').value = $('ifsc').value.toUpperCase(); });

  // ---------- Numeric-only enforcement ----------
  ['mobile','aadhaar','permPincode','currPincode','uan','emgNum1','emgNum2','accountNumber','confirmAccountNumber']
    .forEach(id => $(id).addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g,''); 
    }));

  // ---------- Date of Joining ----------
  function setDojWindow() {
    const today = new Date();
    const max = today.toISOString().split('T')[0];
    const minDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const min = minDate.toISOString().split('T')[0];
    const doj = $('doj');
    doj.min = min;
    doj.max = max;
    doj.addEventListener('input', () => {
      doj.setCustomValidity('');
      if (doj.value && (doj.value < min || doj.value > max)) {
        doj.setCustomValidity('Date of Joining must be today or within last 2 days.');
      }
    });
  }
  setDojWindow();

  // ---------- Marital and Children toggling ----------
  function updateMarital() {
    const val = $('maritalStatus').value;
    if (val === 'Married') {
      show($('spouseSection'));
      show($('spouseAadhaarUpload'));
      setReq($('spouseName'), true);
      setReq($('spouseDob'), true);
      setReq($('marriageDate'), true);
      setReq($('hasChildren'), true);
      setReq($('spouseAadhaar'), true);
    } else {
      hide($('spouseSection'));
      hide($('spouseAadhaarUpload'));
      setReq($('spouseName'), false);
      setReq($('spouseDob'), false);
      setReq($('marriageDate'), false);
      setReq($('hasChildren'), false);
      setReq($('spouseAadhaar'), false);
      hide($('childrenBlock'));
      hide($('childrenAadhaarUpload'));
      setReq($('childrenCount'), false);
      setReq($('childrenAadhaar'), false);
      toggleChildrenCount('0');
    }
    setReq($('fatherDob'), true);
    setReq($('motherName'), true);
    setReq($('motherDob'), true);
  }

  function updateHasChildren() {
    const val = $('hasChildren').value;
    if (val === 'Yes') {
      show($('childrenBlock'));
      show($('childrenAadhaarUpload'));
      setReq($('childrenCount'), true);
      setReq($('childrenAadhaar'), true);
    } else {
      hide($('childrenBlock'));
      hide($('childrenAadhaarUpload'));
      setReq($('childrenCount'), false);
      setReq($('childrenAadhaar'), false);
      toggleChildrenCount('0');
    }
  }

  function toggleChildrenCount(val = $('childrenCount').value) {
    hide($('child1')); hide($('child2'));
    setReq($('child1Name'), false); setReq($('child1Dob'), false);
    setReq($('child2Name'), false); setReq($('child2Dob'), false);
    if (val === '1') {
      show($('child1'));
      setReq($('child1Name'), true); setReq($('child1Dob'), true);
    } else if (val === '2') {
      show($('child1')); show($('child2'));
      setReq($('child1Name'), true); setReq($('child1Dob'), true);
      setReq($('child2Name'), true); setReq($('child2Dob'), true);
    }
  }

  function updatehasbrother() {
    const val = $('hasbrother').value;
    if (val === 'Yes') {
      show($('brotherBlock'));
      setReq($('BrotherCount'), true);
    } else {
      hide($('brotherBlock'));
      setReq($('BrotherCount'), false);
      toggleBrotherCount('0');
    }
  }

  function toggleBrotherCount(val = $('BrotherCount').value) {
    hide($('Brother1')); hide($('Brother2')); hide($('Brother3'));
    setReq($('BrotherName1'), false); setReq($('BrotherNumber1'), false); setReq($('BrotherOccupation1'), false);
    setReq($('BrotherName2'), false); setReq($('BrotherNumber2'), false); setReq($('BrotherOccupation2'), false);
    setReq($('BrotherName3'), false); setReq($('BrotherNumber3'), false); setReq($('BrotherOccupation3'), false);
    if (val === '1') {
      show($('Brother1'));
      setReq($('BrotherName1'), true); setReq($('BrotherNumber1'), true); setReq($('BrotherOccupation1'), true);
    } else if (val === '2') {
      show($('Brother1')); show($('Brother2'));
      setReq($('BrotherName1'), true); setReq($('BrotherNumber1'), true); setReq($('BrotherOccupation1'), true);
      setReq($('BrotherName2'), true); setReq($('BrotherNumber2'), true); setReq($('BrotherOccupation2'), true);
    } else if (val === '3') {
      show($('Brother1')); show($('Brother2')); show($('Brother3'));
      setReq($('BrotherName1'), true); setReq($('BrotherNumber1'), true); setReq($('BrotherOccupation1'), true);
      setReq($('BrotherName2'), true); setReq($('BrotherNumber2'), true); setReq($('BrotherOccupation2'), true);
      setReq($('BrotherName3'), true); setReq($('BrotherNumber3'), true); setReq($('BrotherOccupation3'), true); 
    }
  }

  // ---------- Department & Bank toggling ----------
  function updateDepartment() {
    const val = $('department').value;
    if (val === 'Other') {
      show($('otherDeptWrap'));
      setReq($('otherDepartment'), true);
      hide($('designationWrap'));
      setReq($('designation'), false);
    } else {
      hide($('otherDeptWrap'));
      setReq($('otherDepartment'), false);
      show($('designationWrap'));
      setReq($('designation'), true);
    }
  }

  function updateBank() {
    const val = $('bank').value;
    if (val === 'Other') {
      show($('otherBankWrap'));
      setReq($('otherBank'), true);
    } else {
      hide($('otherBankWrap'));
      setReq($('otherBank'), false);
    }
  }

  // ---------- Experience vs Fresher ----------
  function updateExpStatus() {
    const val = $('expStatus').value;
    if (val === 'Experienced') {
      show($('expDetails')); hide($('fresherDetails'));
      ['prevCompany','prevDesignation','prevBranch','lastWorkingDay'].forEach(id=>setReq($(id), true));
      setReq($('refBy'), false); hide($('refExtra')); setReq($('refCode'), false); setReq($('refName'), false);
      show($('relievingWrap')); show($('salarySlipWrap'));
      setReq($('relievingLetter'), true);
      setReq($('salarySlips'), true);
    } else if (val === 'Fresher') {
      hide($('expDetails')); show($('fresherDetails'));
      ['prevCompany','prevDesignation','prevBranch','lastWorkingDay'].forEach(id=>setReq($(id), false));
      setReq($('refBy'), true);
      hide($('relievingWrap')); hide($('salarySlipWrap'));
      setReq($('relievingLetter'), false);
      setReq($('salarySlips'), false);
    } else {
      hide($('expDetails')); hide($('fresherDetails'));
      ['prevCompany','prevDesignation','prevBranch','lastWorkingDay','refBy','refCode','refName'].forEach(id=>setReq($(id), false));
      hide($('refExtra'));
      hide($('relievingWrap')); hide($('salarySlipWrap'));
      setReq($('relievingLetter'), false);
      setReq($('salarySlips'), false);
    }
  }

  function updateRefBy() {
    const val = $('refBy').value;
    if (val === 'Seeds Employee reference') {
      show($('refExtra'));
      setReq($('refCode'), true);
      setReq($('refName'), true);
    } else {
      hide($('refExtra'));
      setReq($('refCode'), false);
      setReq($('refName'), false);
    }
  }
  
  let employeeData = {};

  // Load all employee data once at form load
  window.addEventListener("DOMContentLoaded", () => {
    fetch("https://script.google.com/macros/s/AKfycbwGTxbFgHzI095yzsNPLe-ksdX7skbsrQ2l1t3hm-xmE54jLUbFaz_EiOdJhI3-U2Xf/exec")
      .then(r => r.json())
      .then(data => {
        employeeData = data; // store in memory
        console.log("Employee data loaded:", Object.keys(employeeData).length, "records");
      })
      .catch(err => console.error("Error loading employee master:", err));
  });

  // Lookup instantly in browser (no server call)
  document.getElementById("refCode").addEventListener("input", function () {
    const code = this.value.trim();
    document.getElementById("refName").value = employeeData[code] || "";
  });

  // ---------- Same address copy ----------
  $('sameAddress').addEventListener('change', (e) => {
    const isChecked = e.target.checked;
    if (isChecked) {
      $('currAddress').value = $('permAddress').value;
      $('currCity').value = $('permCity').value;
      $('currState').value = $('permState').value;
      $('currPincode').value = $('permPincode').value;
      $('currAddress').readOnly = true;
      $('currCity').readOnly = true;
      $('currState').readOnly = true;
      $('currPincode').readOnly = true;
    } else {
      $('currAddress').value = '';
      $('currCity').value = '';
      $('currState').value = '';
      $('currPincode').value = '';
      $('currAddress').readOnly = false;
      $('currCity').readOnly = false;
      $('currState').readOnly = false;
      $('currPincode').readOnly = false;
    }
  });

  // ---------- Account match ----------
  function checkAccountMatch() {
    const a = $('accountNumber').value.trim();
    const b = $('confirmAccountNumber').value.trim();
    if (a && b && a !== b) {
      show($('acctErr'));
      $('confirmAccountNumber').setCustomValidity('Account numbers do not match.');
    } else {
      hide($('acctErr'));
      $('confirmAccountNumber').setCustomValidity('');
    }
  }
  $('accountNumber').addEventListener('input', checkAccountMatch);
  $('confirmAccountNumber').addEventListener('input', checkAccountMatch);

  // ---------- Emergency numbers ----------
  function checkEmergencyDifferent() {
    const m = $('mobile').value;
    const e1 = $('emgNum1').value;
    const e2 = $('emgNum2').value;
    if (m && e1 && m === e1) { show($('emg1Err')); $('emgNum1').setCustomValidity('Must be different from mobile'); }
    else { hide($('emg1Err')); $('emgNum1').setCustomValidity(''); }
    if (m && e2 && m === e2) { show($('emg2Err')); $('emgNum2').setCustomValidity('Must be different from mobile'); }
    else { hide($('emg2Err')); $('emgNum2').setCustomValidity(''); }
  }
  $('mobile').addEventListener('input', checkEmergencyDifferent);
  $('emgNum1').addEventListener('input', checkEmergencyDifferent);
  $('emgNum2').addEventListener('input', checkEmergencyDifferent);

  // ---------- Listeners ----------
  $('maritalStatus').addEventListener('change', updateMarital);
  $('hasChildren').addEventListener('change', updateHasChildren);
  $('childrenCount').addEventListener('change', () => toggleChildrenCount());
  $('department').addEventListener('change', updateDepartment);
  $('bank').addEventListener('change', updateBank);
  $('expStatus').addEventListener('change', updateExpStatus);
  $('refBy').addEventListener('change', updateRefBy);

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  // ---------- Form submit ----------
  $('employeeForm').addEventListener('submit', async (e) => {
    checkAccountMatch();
    checkEmergencyDifferent();
    const form = e.target;

    if (!form.checkValidity()) {
      e.preventDefault();
      form.reportValidity();
      return;
    }

    e.preventDefault();

    // ✅ Show loader
    showLoader();

    // Build payload
    const formData = new FormData(form);
    const payload = {};

    async function addSingle(name) {
      if (formData.get(name)?.name) payload[name] = await fileToBase64(formData.get(name));
    }
    await addSingle("signatureUpload");
    await addSingle("resume");
    await addSingle("photo");
    await addSingle("panUpload");

    async function addMultiFiles(name) {
      const files = formData.getAll(name);
      if (files.length && files[0].name) {
        payload[name] = await Promise.all(files.map(f => fileToBase64(f)));
      }
    }
    await addMultiFiles("aadhaarUpload[]");
    await addMultiFiles("Cibil");
    await addMultiFiles("dlUpload[]");
    await addMultiFiles("familyPhoto[]");
    await addMultiFiles("fatherAadhaar[]");
    await addMultiFiles("motherAadhaar[]");
    await addMultiFiles("spouseAadhaar[]");
    await addMultiFiles("childrenAadhaar[]");
    await addMultiFiles("educationCert[]");
    await addMultiFiles("relievingLetter[]");
    await addMultiFiles("salarySlips[]");
    await addMultiFiles("formF[]");
    await addMultiFiles("esicForm[]");
    await addMultiFiles("epfForm[]");

    const finalData = new FormData(form);

    // Add base64 files from payload
    for (const key in payload) {
     if (Array.isArray(payload[key])) {
      payload[key].forEach((file, i) => finalData.append(key, file));
     } else {
       finalData.append(key, payload[key]);
     }
    }

    fetch(form.action, {
     method: "POST",
     body: finalData
    })
    .then(r => r.json())
    .then(data => {
      hideLoader();
      if (data.status === "success") {
        alert("Form submitted successfully!");
        form.reset();
      } else {
        alert("Error: " + data.message);
      }
    })
    .catch(err => {
      hideLoader();
      alert("Error submitting form: " + err);
    });
  });

  // ---------- Init ----------
  setDojWindow();
  updateMarital();
  updateHasChildren();
  toggleChildrenCount('0');
  updateDepartment();
  updateBank();
  updateExpStatus();
  updateRefBy();
</script>
<div id="loaderOverlay">
  <div class="loader"></div>
  <p>Please wait... Submitting your form</p>
</div>
</body>
</html>
